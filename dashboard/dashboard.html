<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Command Center</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        
        header { 
            text-align: center; 
            padding: 30px 0;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        header h1 { font-size: 2.5em; color: #4caf50; margin-bottom: 10px; }
        header p { color: #888; }
        
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 30px;
        }
        
        .stat-box {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s;
        }
        .stat-box:hover { transform: translateY(-5px); }
        
        .stat-box h2 { font-size: 1.3em; margin-bottom: 12px; }
        .stat-box.gmail h2 { color: #ea4335; }
        .stat-box.whatsapp h2 { color: #25d366; }
        .stat-box.instagram h2 { color: #e4405f; }
        .stat-box.linkedin h2 { color: #0a66c2; }
        .stat-box.facebook h2 { color: #1877f2; }
        .stat-box.twitter h2 { color: #1da1f2; }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            font-size: 0.9em;
        }
        .stat-item:last-child { border-bottom: none; }
        .stat-value { font-size: 1.3em; font-weight: bold; color: #4caf50; }
        .stat-value.inactive { color: #f44336; }
        .stat-value.warning { color: #ff9800; }
        
        .command-section {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .command-section h2 { margin-bottom: 20px; color: #4caf50; }
        
        .platform-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .platform-select label {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 1em;
            margin-bottom: 15px;
        }
        
        .buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
        }
        
        .btn-gmail { background: #ea4335; }
        .btn-whatsapp { background: #25d366; }
        .btn-instagram { background: linear-gradient(45deg, #e4405f, #f09433); }
        .btn-linkedin { background: #0a66c2; }
        .btn-fb { background: #1877f2; }
        .btn-tw { background: #1da1f2; }
        .btn-all { background: linear-gradient(90deg, #ea4335, #25d366, #1877f2); }
        .btn-refresh { background: #4caf50; }
        
        button:hover { transform: scale(1.05); opacity: 0.9; }
        
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .posts-column {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .posts-column h3 { 
            margin-bottom: 15px; 
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            color: #4caf50;
            font-size: 1.1em;
        }
        
        .post-item {
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #333;
        }
        .post-item.gmail { border-left-color: #ea4335; }
        .post-item.whatsapp { border-left-color: #25d366; }
        .post-item.instagram { border-left-color: #e4405f; }
        .post-item.linkedin { border-left-color: #0a66c2; }
        .post-item.fb { border-left-color: #1877f2; }
        .post-item.tw { border-left-color: #1da1f2; }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .platform-badge {
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: bold;
        }
        .badge-gmail { background: rgba(234, 67, 53, 0.3); color: #ea4335; }
        .badge-whatsapp { background: rgba(37, 211, 102, 0.3); color: #25d366; }
        .badge-instagram { background: rgba(228, 64, 95, 0.3); color: #e4405f; }
        .badge-linkedin { background: rgba(10, 102, 194, 0.3); color: #0a66c2; }
        .badge-fb { background: rgba(24, 119, 242, 0.3); color: #1877f2; }
        .badge-tw { background: rgba(29, 161, 242, 0.3); color: #1da1f2; }
        
        .post-time { color: #888; font-size: 0.8em; }
        .post-content { line-height: 1.5; color: #ddd; white-space: pre-line; font-size: 0.9em; }
        
        .logs-section {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .logs-section h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            color: #4caf50;
        }
        
        .log-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            font-size: 0.85em;
        }
        
        #status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
            z-index: 1000;
        }
        .success { background: #4caf50; color: white; }
        .error { background: #f44336; color: white; }
        
        .refresh-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div id="status"></div>
    
    <div class="container">
        <header>
            <h1>üìä Social Media Command Center</h1>
            <p id="timestamp">Loading...</p>
        </header>
        
        <div class="stats">
            <div class="stat-box gmail">
                <h2>üìß Gmail</h2>
                <div class="stat-item"><span>Total:</span><span class="stat-value" id="gmail-total">-</span></div>
                <div class="stat-item"><span>Today:</span><span class="stat-value" id="gmail-today">-</span></div>
                <div class="stat-item"><span>Status:</span><span class="stat-value" id="gmail-status">‚óè Active</span></div>
            </div>

            <div class="stat-box whatsapp">
                <h2>üí¨ WhatsApp</h2>
                <div class="stat-item"><span>Total:</span><span class="stat-value" id="whatsapp-total">-</span></div>
                <div class="stat-item"><span>Today:</span><span class="stat-value" id="whatsapp-today">-</span></div>
                <div class="stat-item"><span>Status:</span><span class="stat-value" id="whatsapp-status">‚óè Active</span></div>
            </div>

            <!-- Instagram hidden -->

            <div class="stat-box linkedin">
                <h2>üíº LinkedIn</h2>
                <div class="stat-item"><span>Total:</span><span class="stat-value" id="linkedin-total">-</span></div>
                <div class="stat-item"><span>Today:</span><span class="stat-value" id="linkedin-today">-</span></div>
                <div class="stat-item"><span>Status:</span><span class="stat-value" id="linkedin-status">‚óè Active</span></div>
            </div>

            <div class="stat-box facebook">
                <h2>üìò Facebook</h2>
                <div class="stat-item"><span>Total:</span><span class="stat-value" id="fb-total">-</span></div>
                <div class="stat-item"><span>Today:</span><span class="stat-value" id="fb-today">-</span></div>
                <div class="stat-item"><span>Status:</span><span class="stat-value" id="fb-status">‚óè Active</span></div>
            </div>

            <div class="stat-box twitter">
                <h2>üê¶ Twitter</h2>
                <div class="stat-item"><span>Total:</span><span class="stat-value" id="tw-total">-</span></div>
                <div class="stat-item"><span>Today:</span><span class="stat-value" id="tw-today">-</span></div>
                <div class="stat-item"><span>Status:</span><span class="stat-value" id="tw-status">‚óè Active</span></div>
            </div>
        </div>
        
        <div class="command-section">
            <h2>üéØ Quick Post</h2>
            <div class="platform-select">
                <label><input type="checkbox" value="gmail"> üìß Gmail</label>
                <label><input type="checkbox" value="whatsapp"> üí¨ WhatsApp</label>
                <!-- Instagram hidden -->
                <label><input type="checkbox" value="linkedin"> üíº LinkedIn</label>
                <label><input type="checkbox" value="facebook"> üìò Facebook</label>
                <label><input type="checkbox" value="twitter"> üê¶ Twitter</label>
            </div>
            <textarea id="postContent" placeholder="Type your message here..."></textarea>
            <div class="buttons">
                <button class="btn-all" onclick="postToAll()">üöÄ Post to All Selected</button>
                <button class="btn-gmail" onclick="post('gmail')">üìß Gmail</button>
                <button class="btn-whatsapp" onclick="post('whatsapp')">üí¨ WhatsApp</button>
                <button class="btn-instagram" onclick="post('instagram')">üì∏ Instagram</button>
                <button class="btn-linkedin" onclick="post('linkedin')">üíº LinkedIn</button>
                <button class="btn-fb" onclick="post('facebook')">üìò Facebook</button>
                <button class="btn-tw" onclick="post('twitter')">üê¶ Twitter</button>
                <button class="btn-refresh" onclick="refresh()">üîÑ Refresh</button>
            </div>
        </div>

        <div class="command-section">
            <h2>‚öôÔ∏è Platform Configuration</h2>
            <p style="color:#888;margin-bottom:15px;">Configure credentials in <code>.env</code> file</p>
            <div id="config-status" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;">
                Loading configuration status...
            </div>
        </div>
        
        <div class="posts-grid">
            <div class="posts-column">
                <h3>üìß Gmail</h3>
                <div id="gmail-posts">Loading...</div>
            </div>
            <div class="posts-column">
                <h3>üí¨ WhatsApp</h3>
                <div id="whatsapp-posts">Loading...</div>
            </div>
            <!-- Instagram hidden -->
            <div class="posts-column">
                <h3>üíº LinkedIn</h3>
                <div id="linkedin-posts">Loading...</div>
            </div>
            <div class="posts-column">
                <h3>üìò Facebook</h3>
                <div id="fb-posts">Loading...</div>
            </div>
            <div class="posts-column">
                <h3>üê¶ Twitter</h3>
                <div id="tw-posts">Loading...</div>
            </div>
        </div>
        
        <div class="logs-section">
            <h3>üìú Activity Logs</h3>
            <div id="logs">Loading...</div>
        </div>
    </div>
    
    <div class="refresh-info">
        Auto-refresh: <span id="countdown">10</span>s
    </div>
    
    <script>
        const API_BASE = 'http://localhost:8081/api';
        const platforms = ['gmail', 'whatsapp', 'linkedin', 'facebook', 'twitter']; // instagram hidden

        function showStatus(msg, type) {
            const s = document.getElementById('status');
            s.textContent = msg;
            s.className = type;
            s.style.display = 'block';
            setTimeout(() => s.style.display = 'none', 3000);
        }

        function getSelectedPlatforms() {
            const checkboxes = document.querySelectorAll('.platform-select input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function post(platform) {
            const content = document.getElementById('postContent').value;
            if (!content) {
                showStatus('Please enter content!', 'error');
                return;
            }

            showStatus('Posting to ' + platform + '...', 'success');

            fetch(API_BASE + '/post', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: 'post_' + platform, content: content})
            })
            .then(r => r.json())
            .then(result => {
                if (result.status === 'success') {
                    showStatus(result.message, 'success');
                    document.getElementById('postContent').value = '';
                    setTimeout(() => loadData(), 1500);
                } else if (result.status === 'info') {
                    showStatus(result.message, 'success');
                } else {
                    showStatus(result.message || 'Error posting', 'error');
                }
            })
            .catch(e => showStatus('Server error - make sure dashboard is running', 'error'));
        }

        function postToAll() {
            const selected = getSelectedPlatforms();
            if (selected.length === 0) {
                showStatus('Select at least one platform!', 'error');
                return;
            }

            const content = document.getElementById('postContent').value;
            if (!content) {
                showStatus('Please enter content!', 'error');
                return;
            }

            showStatus('Posting to ' + selected.length + ' platforms...', 'success');

            let completed = 0;
            selected.forEach(platform => {
                fetch(API_BASE + '/post', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'post_' + platform, content: content})
                })
                .then(() => completed++)
                .catch(() => completed++);
            });

            setTimeout(() => {
                showStatus('Posted to all selected platforms!', 'success');
                document.getElementById('postContent').value = '';
                loadData();
            }, 2000);
        }

        function refresh() {
            showStatus('Refreshing...', 'success');
            loadData();
        }

        function loadStats() {
            fetch(API_BASE + '/stats?t=' + Date.now())
                .then(r => r.json())
                .then(stats => {
                    platforms.forEach(p => {
                        const data = stats[p] || {total: 0, today: 0};
                        document.getElementById(p + '-total').textContent = data.total;
                        document.getElementById(p + '-today').textContent = data.today;
                    });
                })
                .catch(e => console.error('Stats error:', e));
            
            // Load platform status
            fetch(API_BASE + '/status?t=' + Date.now())
                .then(r => r.json())
                .then(status => {
                    platforms.forEach(p => {
                        const el = document.getElementById(p + '-status');
                        const platformData = status[p] || {};
                        if (platformData.configured) {
                            if (platformData.last_error) {
                                el.textContent = '‚ö† ' + platformData.last_error;
                                el.className = 'stat-value warning';
                            } else {
                                el.textContent = '‚óè Active';
                                el.className = 'stat-value';
                            }
                        } else {
                            el.textContent = '‚óã Not configured';
                            el.className = 'stat-value inactive';
                        }
                    });
                })
                .catch(e => console.error('Status error:', e));
        }

        function loadPlatform(platform) {
            fetch(API_BASE + '/posts/' + platform + '?t=' + Date.now())
                .then(r => r.json())
                .then(posts => {
                    let html = '';
                    if (posts.length > 0) {
                        posts.slice(-5).reverse().forEach(p => {
                            const content = p.content || p.body || p.caption || 'No content';
                            const time = (p.timestamp || '').slice(0,16).replace('T', ' ');
                            const status = p.status || 'unknown';
                            const isError = status.startsWith('error');
                            const statusIcon = status === 'success' ? '‚úÖ' : (isError ? '‚ùå' : '‚è≥');
                            const errorClass = isError ? 'style="background:rgba(244,67,54,0.2);"' : '';
                            
                            html += '<div class="post-item ' + platform + '" ' + errorClass + '>';
                            html += '<div class="post-header">';
                            html += '<span class="platform-badge badge-' + platform + '">' + statusIcon + ' ' + platform.charAt(0).toUpperCase() + platform.slice(1) + '</span>';
                            html += '<span class="post-time">' + time + '</span></div>';
                            if (isError) {
                                html += '<div class="post-content" style="color:#f44336;">Error: ' + status.substring(6) + '</div>';
                                html += '<div class="post-content" style="font-size:0.8em;margin-top:5px;">' + content.slice(0, 100) + '...</div>';
                            } else {
                                html += '<div class="post-content">' + content.slice(0, 150) + (content.length > 150 ? '...' : '') + '</div>';
                            }
                            html += '</div>';
                        });
                    } else {
                        html = '<p style="color:#666;text-align:center;padding:20px;">No posts yet</p>';
                    }
                    document.getElementById(platform + '-posts').innerHTML = html;
                })
                .catch(e => {
                    document.getElementById(platform + '-posts').innerHTML = '<p style="color:#f44336;text-align:center;padding:20px;">Error loading posts</p>';
                });
        }

        function loadLogs() {
            const today = new Date().toISOString().slice(0,10).replace(/-/g, '');
            fetch(API_BASE + '/logs?date=' + today + '&t=' + Date.now())
                .then(r => r.json())
                .then(logs => {
                    let html = '';
                    if (logs.length > 0) {
                        logs.slice(-15).reverse().forEach(l => {
                            const time = (l.timestamp || '').slice(0,19).replace('T', ' ');
                            const platform = l.platform || 'Unknown';
                            const status = l.status || 'unknown';
                            const statusClass = status === 'success' ? '‚úÖ' : (status.startsWith('error') ? '‚ùå' : '‚è≥');
                            const content = (l.content || '').slice(0,80);
                            
                            html += '<div class="log-item">';
                            html += '<strong>' + time + '</strong> - ';
                            html += '<span class="platform-badge badge-' + platform.toLowerCase() + '">' + statusClass + ' ' + platform + '</span>: ';
                            html += content + '...</div>';
                        });
                    } else {
                        html = '<p style="color:#666;text-align:center;padding:20px;">No activity yet</p>';
                    }
                    document.getElementById('logs').innerHTML = html;
                })
                .catch(e => {
                    document.getElementById('logs').innerHTML = '<p style="color:#f44336;text-align:center;padding:20px;">Error loading logs</p>';
                });
        }

        function loadConfigStatus() {
            fetch(API_BASE + '/status?t=' + Date.now())
                .then(r => r.json())
                .then(status => {
                    let html = '';
                    platforms.forEach(p => {
                        const data = status[p] || {};
                        const configured = data.configured;
                        const partial = data.partial;
                        const error = data.last_error;
                        const hint = data.hint || '';
                        
                        let icon, color, statusText;
                        
                        if (configured) {
                            icon = error ? '‚ö†Ô∏è' : '‚úÖ';
                            color = error ? '#ff9800' : '#4caf50';
                            statusText = error || 'Ready';
                        } else if (partial) {
                            icon = '‚è≥';
                            color = '#ff9800';
                            statusText = 'Partial setup';
                        } else {
                            icon = '‚ùå';
                            color = '#f44336';
                            statusText = 'Not configured';
                        }
                        
                        html += '<div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;border-left:3px solid ' + color + ';">';
                        html += '<strong>' + icon + ' ' + p.charAt(0).toUpperCase() + p.slice(1) + '</strong><br>';
                        html += '<span style="color:' + color + ';font-size:0.85em;">' + statusText + '</span>';
                        if (hint) {
                            html += '<br><span style="color:#888;font-size:0.8em;">' + hint + '</span>';
                        }
                        html += '</div>';
                    });
                    document.getElementById('config-status').innerHTML = html;
                })
                .catch(e => {
                    document.getElementById('config-status').innerHTML = '<p style="color:#f44336;">Error loading status</p>';
                });
        }

        function loadData() {
            const now = new Date().toLocaleString();
            document.getElementById('timestamp').textContent = 'Last updated: ' + now;

            loadStats();
            loadConfigStatus();

            platforms.forEach(p => loadPlatform(p));

            loadLogs();
        }

        // Check server health on load
        function checkServer() {
            fetch(API_BASE + '/health')
                .then(r => r.json())
                .then(data => {
                    console.log('Server healthy:', data);
                })
                .catch(e => {
                    showStatus('Dashboard server not running! Start with: python dashboard_server.py', 'error');
                });
        }

        // Initial load
        checkServer();
        loadData();

        // Auto-refresh
        let countdown = 10;
        setInterval(() => {
            countdown--;
            document.getElementById('countdown').textContent = countdown;
            if (countdown <= 0) {
                countdown = 10;
                loadData();
            }
        }, 1000);
    </script>
</body>
</html>
